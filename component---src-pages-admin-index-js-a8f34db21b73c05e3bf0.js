"use strict";(self.webpackChunkv4=self.webpackChunkv4||[]).push([[791],{2460:function(e,t,a){a.r(t);var n=a(6540),r=a(5090),i=a(6755);const o={}.GATSBY_REPO_OWNER,l={}.GATSBY_REPO_NAME,s={}.GATSBY_BRANCH_NAME,c={Authorization:`token ${{}.GATSBY_GITHUB_TOKEN}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},m=async function(e,t,a){void 0===t&&(t="GET"),void 0===a&&(a=null);const n={method:t,headers:c};a&&(n.body=JSON.stringify(a));const r=await fetch(e,n);if(!r.ok){const e=await r.json().catch((()=>({message:r.statusText})));throw new Error(`GitHub API Error: ${r.status} - ${e.message||"Unknown error"}`)}return r.json()},g=async(e,t)=>{const a=`https://api.github.com/repos/${o}/${l}/git/blobs/${t}`,n=await m(a);return(new TextDecoder).decode(Uint8Array.from(atob(n.content),(e=>e.charCodeAt(0))))},p=async function(e){void 0===e&&(e="");return m(`https://api.github.com/repos/${o}/${l}/contents/${e}?ref=${s}`)},d=async function(e,t,a,n){void 0===n&&(n=null);const r=`https://api.github.com/repos/${o}/${l}/contents/${e}`,i=btoa(unescape(encodeURIComponent(t)));return m(r,"PUT",{message:a,content:i,branch:s,sha:n})},h=async(e,t,a)=>m(`https://api.github.com/repos/${o}/${l}/contents/${e}`,"DELETE",{message:t,branch:s,sha:a}),u=r.Ay.main.withConfig({displayName:"admin__StyledAdminContainer",componentId:"ypz0h-0"})(["padding:var(--nav-height) 0;max-width:900px;margin:0 auto;min-height:calc(100vh - var(--nav-height) - 50px);h1{font-size:var(--fz-heading);color:var(--lightest-slate);margin-bottom:20px;text-align:center;}.section-title{margin-top:50px;margin-bottom:30px;font-size:var(--fz-xl);color:var(--green);border-bottom:1px solid var(--light-navy);padding-bottom:10px;}.form-group{margin-bottom:20px;label{display:block;font-size:var(--fz-md);color:var(--light-slate);margin-bottom:8px;}input[type='text'],input[type='datetime-local'],input[type='date'],textarea,select{width:100%;padding:10px;border:1px solid var(--light-navy);border-radius:var(--border-radius);background-color:var(--navy);color:var(--lightest-slate);font-family:var(--font-mono);font-size:var(--fz-md);&:focus{outline:1px solid var(--green);}}input[type='file']{width:100%;padding:10px 0;color:var(--light-slate);font-family:var(--font-mono);font-size:var(--fz-md);}textarea{min-height:200px;resize:vertical;}}.button-group{display:flex;gap:10px;margin-top:20px;button{",";margin:0;}}.post-list{margin-top:40px;list-style:none;padding:0;li{background-color:var(--light-navy);padding:15px 20px;margin-bottom:10px;border-radius:var(--border-radius);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;.post-info{flex-grow:1;h3{color:var(--lightest-slate);font-size:var(--fz-lg);margin:0 0 5px 0;}p{color:var(--slate);font-size:var(--fz-sm);margin:0;}}.post-actions{display:flex;gap:10px;button{margin:0;",";padding:8px 12px;font-size:var(--fz-xs);}}}}.status-message{margin-top:20px;padding:10px;border-radius:var(--border-radius);background-color:var(--light-navy);color:var(--green);font-size:var(--fz-md);text-align:center;}"],(e=>{let{theme:t}=e;return t.mixins.smallButton}),(e=>{let{theme:t}=e;return t.mixins.smallButton}));t.default=e=>{let{location:t}=e;const{0:a,1:r}=(0,n.useState)({type:"posts",title:"",date:(new Date).toISOString().slice(0,16),description:"",tags:"",body:"",imageFile:null,imageUrl:"",github:"",external:"",tech:"",company:"",range:"",startDate:(new Date).toISOString().slice(0,10),endDate:""}),{0:c,1:f}=(0,n.useState)([]),{0:y,1:b}=(0,n.useState)(!1),{0:v,1:E}=(0,n.useState)(""),{0:x,1:$}=(0,n.useState)(null),w=async()=>{b(!0),E("Đang tải nội dung...");try{const a=[],n=["content/posts","content/projects","content/featured","content/jobs"];for(const r of n)try{const t=await p(r);for(const n of t)if("file"===n.type&&n.name.endsWith(".md")){const t=await g(n.path,n.sha),i=t.split("---");let o={},l="";if(i.length>2){try{const e=i[1];o=C(e)}catch(e){console.warn(`Could not parse frontmatter for ${n.path}:`,e)}l=i.slice(2).join("---").trim()}else l=t.trim();a.push({path:n.path,name:n.name,sha:n.sha,frontmatter:o,body:l,type:r.split("/")[1]})}}catch(t){return console.error(`Error fetching content from ${r}:`,t),void E(`Lỗi khi tải nội dung từ ${r}: ${t.message}. Vui lòng đảm bảo PAT chính xác.`)}f(a),E("Tải nội dung thành công.")}catch(t){console.error("Error fetching all content:",t),E(`Lỗi khi tải nội dung tổng thể: ${t.message}. Vui lòng đảm bảo PAT chính xác.`)}finally{b(!1)}};(0,n.useEffect)((()=>{w()}),[]);const N=e=>{r({...a,[e.target.name]:e.target.value})},C=e=>{const t=e.split("\n").map((e=>e.trim())).filter(Boolean),a={};return t.forEach((e=>{const t=e.indexOf(":");if(t>-1){let n=e.substring(0,t).trim(),r=e.substring(t+1).trim();r.startsWith("[")&&r.endsWith("]")?r=r.substring(1,r.length-1).split(",").map((e=>e.trim())):"true"===r.toLowerCase()?r=!0:"false"===r.toLowerCase()?r=!1:isNaN(r)||isNaN(parseFloat(r))?(r.startsWith('"')&&r.endsWith('"')||r.startsWith("`")&&r.endsWith("`"))&&(r=r.substring(1,r.length-1)):r=parseFloat(r),a[n]=r}})),a},D=e=>{const t={};let a="",n="";switch(e.type){case"posts":t.title=e.title,t.date=e.date,t.description=e.description,e.tags&&(t.tags=e.tags.split(",").map((e=>e.trim()))),e.imageUrl&&(t.image=e.imageUrl),a=`${new Date(e.date).toISOString().slice(0,10)}-${e.title.toLowerCase().replace(/\s/g,"-")}.md`,n=`content/posts/${e.title.toLowerCase().replace(/\s/g,"-")}/index.md`;break;case"projects":t.title=e.title,t.description=e.description,e.github&&(t.github=e.github),e.external&&(t.external=e.external),e.tech&&(t.tech=e.tech.split(",").map((e=>e.trim()))),t.date=e.date,a=`${e.title.toLowerCase().replace(/\s/g,"-")}.md`,n=`content/projects/${a}`;break;case"featured":t.title=e.title,t.description=e.description,e.github&&(t.github=e.github),e.external&&(t.external=e.external),e.tech&&(t.tech=e.tech.split(",").map((e=>e.trim()))),e.imageUrl&&(t.image=e.imageUrl),a=`${e.title.toLowerCase().replace(/\s/g,"-")}/index.md`,n=`content/featured/${a}`;break;case"jobs":t.title=e.title,t.company=e.company,e.range&&(t.range=e.range),t.startDate=e.startDate,e.endDate&&(t.endDate=e.endDate),a=`${e.company.toLowerCase().replace(/\s/g,"-")}.md`,n=`content/jobs/${a}`;break;default:return{content:"",path:""}}return{content:`${(e=>{let t="";for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)){let n=e[a];Array.isArray(n)?n=`[${n.map((e=>"string"==typeof e?`'${e}'`:e)).join(", ")}]`:"string"==typeof n&&(n.includes(":")||n.includes(" ")||n.includes("/")||n.includes("."))&&(n=`"${n}"`),t+=`${a}: ${n}\n`}return`---\n${t}---`})(t)}\n\n${e.body}`,path:n}};return n.createElement(i.A,{location:t},n.createElement(u,null,n.createElement("h1",null,x?"Chỉnh sửa Nội dung":"Tạo Nội dung Mới"),v&&n.createElement("div",{className:"status-message"},v),n.createElement("form",{onSubmit:async e=>{e.preventDefault(),b(!0),E("");let t=a.imageUrl,n=null;try{if(a.imageFile){E("Đang tải ảnh lên...");const e=new FileReader;e.readAsDataURL(a.imageFile),await new Promise(((r,i)=>{e.onload=async()=>{const c=e.result.split(",")[1],g=a.imageFile.name,d=`feat(upload): Upload image ${g}`;try{if(x&&x.frontmatter.image){const e=x.frontmatter.image.startsWith("/")?x.frontmatter.image.substring(1):x.frontmatter.image;try{const t=await p(e);n=t.sha}catch(h){console.warn("Could not find existing image SHA, creating new one.",h),n=null}}const e=await async function(e,t,a,n){return void 0===n&&(n=null),m(`https://api.github.com/repos/${o}/${l}/contents/static/images/uploads/${e}`,"PUT",{message:a,content:t,branch:s,sha:n})}(g,c,d,n);t=e.content.path,E(`Tải ảnh "${g}" thành công.`),r()}catch(u){console.error("Error uploading image:",u),E(`Lỗi khi tải ảnh lên: ${u.message}`),i(u)}},e.onerror=e=>i(e)}))}const e={...a,imageUrl:t},{content:c,path:g}=D(e);if(!g)return E("Lỗi: Không thể tạo đường dẫn tệp cho loại nội dung này."),void b(!1);const h=x?`feat(${a.type}): Update ${a.title}`:`feat(${a.type}): New ${a.title}`;if(x)await d(g,c,h,x.sha),E(`Cập nhật "${a.title}" thành công!`),$(null);else{if("posts"===a.type||"featured"===a.type){const e=g.substring(0,g.lastIndexOf("/"));try{await p(e)}catch(i){if(i.message.includes("404"))return E(`Lỗi: Thư mục cha cho "${a.title}" (${e}) không tồn tại. Vui lòng tạo thủ công.`),void b(!1);throw i}}await d(g,c,h),E(`Tạo "${a.title}" thành công!`)}r({type:a.type,title:"",date:(new Date).toISOString().slice(0,16),description:"",tags:"",body:"",imageFile:null,imageUrl:"",github:"",external:"",tech:"",company:"",range:"",startDate:(new Date).toISOString().slice(0,10),endDate:""}),w()}catch(i){console.error("Error saving content:",i),E(`Lỗi khi lưu nội dung: ${i.message}.`)}finally{b(!1)}}},n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"type"},"Loại Nội dung"),n.createElement("select",{id:"type",name:"type",value:a.type,onChange:e=>{r({...a,type:e.target.value,title:"",date:(new Date).toISOString().slice(0,16),description:"",tags:"",body:"",imageFile:null,imageUrl:"",github:"",external:"",tech:"",company:"",range:"",startDate:(new Date).toISOString().slice(0,10),endDate:""}),$(null)}},n.createElement("option",{value:"posts"},"Bài viết"),n.createElement("option",{value:"projects"},"Dự án"),n.createElement("option",{value:"featured"},"Dự án Nổi bật"),n.createElement("option",{value:"jobs"},"Kinh nghiệm làm việc"))),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"title"},"Tiêu đề"),n.createElement("input",{type:"text",id:"title",name:"title",value:a.title,onChange:N,required:!0})),("posts"===a.type||"featured"===a.type)&&n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"imageFile"},"Ảnh Bìa / Ảnh Đại diện (Tùy chọn)"),n.createElement("input",{type:"file",id:"imageFile",name:"imageFile",accept:"image/*",onChange:e=>{const t=e.target.files[0];t&&r((e=>({...e,imageFile:t})))}}),a.imageUrl&&n.createElement("p",null,"Ảnh hiện tại:"," ",n.createElement("a",{href:a.imageUrl,target:"_blank",rel:"noopener noreferrer"},a.imageUrl.split("/").pop()))),"posts"===a.type&&n.createElement(n.Fragment,null,n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"date"},"Ngày (Bài viết)"),n.createElement("input",{type:"datetime-local",id:"date",name:"date",value:a.date,onChange:N,required:!0})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"description"},"Mô tả (Bài viết)"),n.createElement("input",{type:"text",id:"description",name:"description",value:a.description,onChange:N,required:!0})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"tags"},"Tags (cách nhau bởi dấu phẩy)"),n.createElement("input",{type:"text",id:"tags",name:"tags",value:a.tags,onChange:N}))),("projects"===a.type||"featured"===a.type)&&n.createElement(n.Fragment,null,n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"description"},"Mô tả (Dự án)"),n.createElement("input",{type:"text",id:"description",name:"description",value:a.description,onChange:N,required:!0})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"github"},"URL GitHub"),n.createElement("input",{type:"text",id:"github",name:"github",value:a.github,onChange:N})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"external"},"URL Demo"),n.createElement("input",{type:"text",id:"external",name:"external",value:a.external,onChange:N})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"tech"},"Công nghệ (cách nhau bởi dấu phẩy)"),n.createElement("input",{type:"text",id:"tech",name:"tech",value:a.tech,onChange:N})),"projects"===a.type&&n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"date"},"Ngày (Dự án)"),n.createElement("input",{type:"datetime-local",id:"date",name:"date",value:a.date,onChange:N,required:!0}))),"jobs"===a.type&&n.createElement(n.Fragment,null,n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"company"},"Công ty"),n.createElement("input",{type:"text",id:"company",name:"company",value:a.company,onChange:N,required:!0})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"range"},"Link Công ty (Tùy chọn)"),n.createElement("input",{type:"text",id:"range",name:"range",value:a.range,onChange:N})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"startDate"},"Ngày bắt đầu"),n.createElement("input",{type:"date",id:"startDate",name:"startDate",value:a.startDate,onChange:N,required:!0})),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"endDate"},"Ngày kết thúc (Tùy chọn)"),n.createElement("input",{type:"date",id:"endDate",name:"endDate",value:a.endDate,onChange:N}))),n.createElement("div",{className:"form-group"},n.createElement("label",{htmlFor:"body"},"Nội dung (Markdown)"),n.createElement("textarea",{id:"body",name:"body",value:a.body,onChange:N,required:!0})),n.createElement("div",{className:"button-group"},n.createElement("button",{type:"submit",disabled:y},y?"Đang xử lý...":x?"Cập nhật Nội dung":"Tạo Nội dung"),x&&n.createElement("button",{type:"button",onClick:()=>$(null),disabled:y},"Hủy chỉnh sửa"))),n.createElement("h2",{className:"section-title"},"Nội dung Hiện có"),v&&n.createElement("div",{className:"status-message"},v),y&&n.createElement("div",{className:"status-message"},"Đang tải nội dung..."),c.length>0?n.createElement("ul",{className:"post-list"},c.map((e=>n.createElement("li",{key:e.path},n.createElement("div",{className:"post-info"},n.createElement("h3",null,e.frontmatter.title||e.name),n.createElement("p",null,"Loại: ",e.type),n.createElement("p",null,"Đường dẫn: ",e.path)),n.createElement("div",{className:"post-actions"},n.createElement("button",{onClick:()=>(e=>{$(e),r({type:e.type,title:e.frontmatter.title||"",date:e.frontmatter.date?new Date(e.frontmatter.date).toISOString().slice(0,16):(new Date).toISOString().slice(0,16),description:e.frontmatter.description||"",tags:Array.isArray(e.frontmatter.tags)?e.frontmatter.tags.join(", "):e.frontmatter.tags||"",body:e.body||"",imageUrl:e.frontmatter.image||"",github:e.frontmatter.github||"",external:e.frontmatter.external||"",tech:Array.isArray(e.frontmatter.tech)?e.frontmatter.tech.join(", "):e.frontmatter.tech||"",company:e.frontmatter.company||"",range:e.frontmatter.range||"",startDate:e.frontmatter.startDate||(new Date).toISOString().slice(0,10),endDate:e.frontmatter.endDate||""}),window.scrollTo({top:0,behavior:"smooth"})})(e)},"Chỉnh sửa"),n.createElement("button",{onClick:()=>(async e=>{if(window.confirm(`Bạn có chắc chắn muốn xóa "${e.frontmatter.title}"?`)){b(!0),E("");try{const a=`feat(${e.type}): Delete ${e.frontmatter.title}`;if(await h(e.path,a,e.sha),e.frontmatter.image){const a=e.frontmatter.image.startsWith("/")?e.frontmatter.image.substring(1):e.frontmatter.image;try{const t=await p(a);await h(a,`feat(delete): Delete image for ${e.frontmatter.title}`,t.sha),E(`Xóa "${e.frontmatter.title}" và ảnh liên quan thành công!`)}catch(t){console.warn(`Could not delete image ${a}:`,t),E(`Xóa "${e.frontmatter.title}" thành công, nhưng không thể xóa ảnh liên quan.`)}}else E(`Xóa "${e.frontmatter.title}" thành công!`);w()}catch(a){console.error("Error deleting content:",a),E(`Lỗi khi xóa nội dung: ${a.message}`)}finally{b(!1)}}})(e)},"Xóa")))))):!y&&n.createElement("p",null,"Chưa có nội dung nào.")))}}}]);
//# sourceMappingURL=component---src-pages-admin-index-js-a8f34db21b73c05e3bf0.js.map